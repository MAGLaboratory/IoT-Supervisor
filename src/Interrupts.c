//=========================================================
// src/Interrupts.c: generated by Hardware Configurator
//
// This file will be regenerated when saving a document.
// leave the sections inside the "$[...]" comment tags alone
// or they will be overwritten!
//=========================================================

// USER INCLUDES
#include <SI_EFM8BB1_Register_Enums.h>

// externs
extern bool smRunFlag;
extern bool cprif;
extern bool VinCmp;
extern bool nReset;
extern void VinSm(void);

//-----------------------------------------------------------------------------
// CMP0_ISR
//-----------------------------------------------------------------------------
//
// CMP0 ISR Content goes here. Remember to clear flag bits:
// CMP0CN0::CPFIF (Comparator Falling-Edge Flag)
// CMP0CN0::CPRIF (Comparator Rising-Edge Flag)
//
//-----------------------------------------------------------------------------
SI_INTERRUPT (CMP0_ISR, CMP0_IRQn)
{
	// state machine immediate off
	// clear falling edge flag (should not trigger to but whatever)
	if (CMP0CN0 & CMP0CN0_CPFIF__BMASK)
	{
		CMP0CN0 &= ~(CMP0CN0_CPFIF__BMASK);
	}
	// clear rising edge flag
	if (CMP0CN0 & CMP0CN0_CPRIF__BMASK)
	{
		CMP0CN0 &= ~(CMP0CN0_CPRIF__BMASK);
		cprif = true;
		smRunFlag = true;
	}
}

//-----------------------------------------------------------------------------
// TIMER0_ISR
//-----------------------------------------------------------------------------
//
// TIMER0 ISR Content goes here. Remember to clear flag bits:
// TCON::TF0 (Timer 0 Overflow Flag)
//
// ISR for modbus (1.75 ms or whatever)
//-----------------------------------------------------------------------------
SI_INTERRUPT (TIMER0_ISR, TIMER0_IRQn)
{
	TCON_TF0 = 0;
	TL0 = (0xC7 << TL0_TL0__SHIFT);
	// some modbus switch-on and transmission
}

//-----------------------------------------------------------------------------
// TIMER1_ISR
//-----------------------------------------------------------------------------
//
// TIMER1 ISR Content goes here. Remember to clear flag bits:
// TCON::TF1 (Timer 1 Overflow Flag)
//
// ISR for for timing (8 ms)
//-----------------------------------------------------------------------------
SI_INTERRUPT (TIMER1_ISR, TIMER1_IRQn)
{
	TCON_TF1 = 0;
	TH0 = (0x01 << TH0_TH0__SHIFT);
	smRunFlag = true;
}

